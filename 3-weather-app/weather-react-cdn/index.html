<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Weather App — Level 3 (React CDN)</title>
    <meta name="description" content="Level 3: React component hóa, state/props, không cần build." />
    <link rel="icon" href="assets/icons/01d.svg" />
    <!-- React via CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      :root {
        --bg: #0b1020; --card: #131a2b; --text: #e8ecf1; --muted: #9fb0c1; --primary: #4da3ff;
        --radius: 16px; --gap: 16px; --container: 1100px;
      }
      * { box-sizing: border-box; }
      body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; background: linear-gradient(180deg,#0b1020,#0b1020 30%,#0e1628); color: var(--text); }
      .container { width: min(100% - 24px, var(--container)); margin-inline: auto; }
      header { padding: 20px 0; border-bottom: 1px solid rgba(255,255,255,.06); }
      .row { display: grid; gap: var(--gap); }
      @media(min-width:640px){ .header__row{ grid-template-columns: 1fr auto; } .grid{ grid-template-columns: 1.3fr 1fr; } }
      h1{ margin:0; font-size:22px; } .brand{ color: var(--primary); }
      .btn{ border:1px solid rgba(255,255,255,.12); background:#152038; color:var(--text); padding:10px 14px; border-radius:12px; cursor:pointer; }
      .btn--primary{ background: var(--primary); color:#06111f; border:none; font-weight:600; }
      .search{ display:grid; grid-template-columns: 1fr auto; gap:10px; }
      .search input{ background:#0e1728; color:var(--text); border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:12px 14px; outline:none; }
      .main{ padding:24px 0 40px; }
      .card{ background: var(--card); border:1px solid rgba(255,255,255,.06); border-radius: var(--radius); padding:16px; box-shadow:0 8px 20px rgba(0,0,0,.2); }
      .section-title{ margin:0 0 12px; font-size:16px; color:var(--muted); font-weight:600; }
      .current__top{ display:grid; grid-template-columns:1fr auto; align-items:center; gap:var(--gap); }
      .current__city{ font-size:20px; margin-right:8px; }
      .current__temp{ font-size:42px; font-weight:700; display:flex; align-items:baseline; gap:4px; }
      .current__icon{ width:88px; height:88px; }
      .current__meta{ display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-top:12px; font-size:14px; }
      .meta__item{ background: rgba(255,255,255,.04); padding:10px 12px; border-radius:10px; }
      .forecast__list{ display:grid; grid-template-columns:repeat(5,1fr); gap:10px; list-style:none; padding:0; margin:0; }
      @media(max-width:639px){ .forecast__list{ grid-template-columns: repeat(2,1fr);} }
      .forecast__item{ display:grid; place-items:center; gap:6px; background: rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.06); border-radius:12px; padding:10px; }
      .forecast__icon{ width:44px; height:44px; }
      footer{ padding:18px 0 28px; border-top:1px solid rgba(255,255,255,.06); margin-top:24px; }
      .footer__row{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
      .unit-toggle .btn{ margin-left:4px; }
      .active{ border-color: var(--primary) !important; color: var(--primary) !important; }
      .sr-only{ position:absolute!important; height:1px;width:1px; overflow:hidden; clip:rect(1px,1px,1px,1px); white-space:nowrap; clip-path: inset(50%); border:0; padding:0; margin:-1px; }
    </style>
  </head>
  <body>
    <div id="app"></div>

    <script type="text/babel">
      const { useState, useMemo } = React;

      // Utils
      function toF(c){ return (c * 9/5) + 32; }
      function toC(f){ return (f - 32) * 5/9; }
      const demoForecast = [
        { time:'11:00', tempC:31, icon:'02d', desc:'Mây thưa' },
        { time:'14:00', tempC:32, icon:'03d', desc:'Nhiều mây' },
        { time:'17:00', tempC:29, icon:'10d', desc:'Mưa nhẹ' },
        { time:'20:00', tempC:27, icon:'01n', desc:'Quang mây' },
        { time:'23:00', tempC:26, icon:'04n', desc:'Âm u' },
      ];

      // Components
      function SearchBar({ city, onCityChange, onSubmit }){
        return (
          <form className="search" role="search" onSubmit={(e)=>{ e.preventDefault(); onSubmit(); }}>
            <label htmlFor="city" className="sr-only">Thành phố</label>
            <input id="city" value={city} onChange={(e)=>onCityChange(e.target.value)} placeholder="Nhập thành phố, ví dụ: Ho Chi Minh" />
            <button className="btn btn--primary" type="submit">Tìm</button>
          </form>
        );
      }

      function UnitToggle({ units, onChange }){
        return (
          <div className="unit-toggle" role="group" aria-label="Đổi đơn vị nhiệt độ">
            <button className={"btn " + (units==='metric'?'active':'')} onClick={()=>onChange('metric')}>°C</button>
            <button className={"btn " + (units==='imperial'?'active':'')} onClick={()=>onChange('imperial')}>°F</button>
          </div>
        );
      }

      function CurrentWeather({ city, country='VN', tempC=30, desc='Nắng nhẹ, ít mây', icon='01d', units='metric' }){
        const value = units==='metric' ? tempC : Math.round(toF(tempC));
        const unitMark = units==='metric' ? '°C' : '°F';
        return (
          <section className="card current" aria-labelledby="current-title">
            <h2 id="current-title" className="section-title">Thời tiết hiện tại</h2>
            <div className="current__top">
              <div>
                <div className="current__location">
                  <span className="current__city">{city}</span> <span className="current__country">{country}</span>
                </div>
                <div className="current__temp"><span className="current__value">{value}</span><span className="unit">{unitMark}</span></div>
                <p className="current__desc">{desc}</p>
              </div>
              <div><img className="current__icon" src={"assets/icons/"+icon+".svg"} alt={desc}/></div>
            </div>
            <div className="current__meta">
              <div className="meta__item"><span>Độ ẩm:</span> <strong>65%</strong></div>
              <div className="meta__item"><span>Gió:</span> <strong>12 km/h</strong></div>
              <div className="meta__item"><span>Cập nhật:</span> <strong>10:30</strong></div>
            </div>
          </section>
        );
      }

      function ForecastList({ items, units='metric' }){
        return (
          <section className="card forecast" aria-labelledby="forecast-title">
            <h2 id="forecast-title" className="section-title">Dự báo 5 phiên</h2>
            <ul className="forecast__list">
              {items.map((it, idx)=>{
                const value = units==='metric' ? it.tempC : Math.round(toF(it.tempC));
                const unitMark = units==='metric' ? '°C' : '°F';
                return (
                  <li className="forecast__item" key={idx}>
                    <img className="forecast__icon" src={"assets/icons/"+it.icon+".svg"} alt={it.desc} />
                    <div className="forecast__time">{it.time}</div>
                    <div className="forecast__temp">{value}{unitMark}</div>
                    <div className="forecast__desc">{it.desc}</div>
                  </li>
                )
              })}
            </ul>
          </section>
        );
      }

      function App(){
        const [city, setCity] = useState('Ho Chi Minh');
        const [units, setUnits] = useState('metric');

        function handleSearch(){
          // Level 3: chỉ update state, chưa gọi API
          // Có thể thêm validate city !== ''
          console.log('Search city:', city);
        }

        return (
          <>
            <header>
              <div className="container row header__row">
                <h1>Weather <span className="brand">App</span> — <span style={{opacity:.7}}>Level 3 (React)</span></h1>
                <div className="row" style={{gridTemplateColumns:'1fr auto', alignItems:'center'}}>
                  <SearchBar city={city} onCityChange={setCity} onSubmit={handleSearch} />
                  <UnitToggle units={units} onChange={setUnits}/>
                </div>
              </div>
            </header>

            <main className="main">
              <div className="container grid">
                <CurrentWeather city={city} units={units} />
                <ForecastList items={demoForecast} units={units} />
              </div>
            </main>

            <footer>
              <div className="container footer__row">
                <p>© 2025 Weather App — Level 3 (React)</p>
                <UnitToggle units={units} onChange={setUnits}/>
              </div>
            </footer>
          </>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('app'));
      root.render(<App/>);
    </script>
  </body>
</html>
