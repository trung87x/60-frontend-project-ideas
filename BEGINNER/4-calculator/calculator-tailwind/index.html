<!DOCTYPE html>
<html lang="vi" class="h-full" data-theme>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Calculator — Level 2 (Tailwind + Dark Mode + A11y)</title>
    <!-- Avoid FOUC: set theme class before paint -->
    <script>
      (function() {
        try {
          const saved = localStorage.getItem('theme');
          const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          const theme = saved || (prefersDark ? 'dark' : 'light');
          if (theme === 'dark') document.documentElement.classList.add('dark');
          document.documentElement.dataset.theme = theme;
        } catch {}
      })();
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <meta name="color-scheme" content="dark light" />
  </head>
  <body class="h-full bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-100 antialiased">
    <main class="min-h-full grid place-items-center p-6">
      <div class="w-full max-w-md">
        <!-- Header -->
        <div class="mb-3 flex items-center justify-between">
          <h1 class="text-lg font-semibold tracking-tight">🧮 Calculator — Level 2</h1>
          <button id="theme-toggle"
                  class="inline-flex items-center gap-2 rounded-xl border border-slate-300/70 bg-white px-3 py-1.5 text-sm font-medium shadow-sm hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400 dark:border-slate-700 dark:bg-slate-900/60 dark:hover:bg-slate-900"
                  type="button"
                  aria-pressed="false"
                  aria-label="Bật tắt Dark Mode">
            <span class="i">🌙</span><span class="hidden sm:inline">Dark</span>
          </button>
        </div>

        <!-- Display -->
        <section class="rounded-2xl border border-slate-300/70 bg-white/70 p-4 shadow-sm backdrop-blur dark:border-slate-800 dark:bg-slate-900/60">
          <div id="live" class="sr-only" aria-live="polite" aria-atomic="true"></div>
          <output id="expr"
                  class="block h-5 overflow-hidden text-ellipsis whitespace-nowrap text-right text-xs text-slate-500 dark:text-slate-400"
                  aria-label="Biểu thức">0</output>
          <output id="result"
                  class="mt-1 block text-right text-4xl font-bold tabular-nums tracking-wide"
                  aria-label="Kết quả">0</output>
        </section>

        <!-- Keypad -->
        <section class="mt-3 grid grid-cols-4 gap-2" role="group" aria-label="Bàn phím máy tính">
          <!-- Row 1 -->
          <button data-key="Escape" class="key key-fn col-span-2" aria-label="Xóa tất cả (C)">C</button>
          <button data-key="Backspace" class="key key-fn" aria-label="Xóa 1 ký tự (⌫)">⌫</button>
          <button data-key="±" class="key key-fn" aria-label="Đổi dấu (±)">±</button>

          <!-- Row 2 -->
          <button data-key="7" class="key">7</button>
          <button data-key="8" class="key">8</button>
          <button data-key="9" class="key">9</button>
          <button data-key="/" class="key key-op" aria-label="Chia">÷</button>

          <!-- Row 3 -->
          <button data-key="4" class="key">4</button>
          <button data-key="5" class="key">5</button>
          <button data-key="6" class="key">6</button>
          <button data-key="*" class="key key-op" aria-label="Nhân">×</button>

          <!-- Row 4 -->
          <button data-key="1" class="key">1</button>
          <button data-key="2" class="key">2</button>
          <button data-key="3" class="key">3</button>
          <button data-key="-" class="key key-op" aria-label="Trừ">−</button>

          <!-- Row 5 -->
          <button data-key="0" class="key col-span-2">0</button>
          <button data-key="." class="key">.</button>
          <button data-key="+" class="key key-op" aria-label="Cộng">+</button>

          <!-- Row 6 -->
          <button data-key="Enter" class="key key-eq col-span-4" aria-label="Bằng">=</button>
        </section>

        <p class="mt-2 text-center text-xs text-slate-500 dark:text-slate-400">
          Mẹo: dùng bàn phím vật lý — <kbd class="rounded border px-1">0‑9</kbd> <kbd class="rounded border px-1">.</kbd>
          <kbd class="rounded border px-1">+</kbd> <kbd class="rounded border px-1">−</kbd> <kbd class="rounded border px-1">×</kbd> <kbd class="rounded border px-1">÷</kbd>
          <kbd class="rounded border px-1">Enter</kbd> <kbd class="rounded border px-1">Backspace</kbd> <kbd class="rounded border px-1">Esc</kbd>
        </p>
      </div>
    </main>

    <script src="./theme.js"></script>
    <script src="./script.js"></script>

    <style>
      /* Key base style via Tailwind @apply (inline for single file simplicity) */
    </style>
    <script>
      // Utility to add Tailwind classes programmatically
      const addKeyStyles = () => {
        document.querySelectorAll('.key').forEach(btn => {
          btn.classList.add(
            'rounded-2xl','border','border-slate-300/70','bg-white','px-4','py-3','text-base','font-medium',
            'shadow-sm','hover:bg-slate-50','active:translate-y-px',
            'focus-visible:outline-none','focus-visible:ring-2','focus-visible:ring-cyan-400',
            'dark:border-slate-800','dark:bg-slate-900/60','dark:hover:bg-slate-900'
          );
        });
        document.querySelectorAll('.key-op').forEach(btn => {
          btn.classList.add('bg-slate-100','hover:bg-slate-200','dark:bg-slate-800','dark:hover:bg-slate-700');
        });
        document.querySelectorAll('.key-fn').forEach(btn => {
          btn.classList.add('bg-slate-100','hover:bg-slate-200','dark:bg-slate-800','dark:hover:bg-slate-700');
        });
        document.querySelectorAll('.key-eq').forEach(btn => {
          btn.classList.add('bg-blue-600','text-white','hover:bg-blue-500','dark:bg-blue-500','dark:hover:bg-blue-400','font-semibold');
        });
      };
      addKeyStyles();
    </script>
  </body>
</html>
