<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Weather Dashboard — Level 3 (Tailwind)</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-dvh bg-gradient-to-br from-slate-900 to-indigo-950 text-slate-100">
  <header class="py-6 text-center">
    <h1 class="text-2xl font-bold">⛅ Weather Dashboard</h1>
    <p class="text-slate-400">Tailwind UI + fetch lat/lon</p>
  </header>

  <main class="w-[min(1100px,92vw)] mx-auto pb-10">
    <div class="flex gap-2 justify-center mb-3">
      <input id="lat" class="px-3 py-2 rounded-lg bg-slate-900 border border-slate-800 outline-none" placeholder="Vĩ độ" />
      <input id="lon" class="px-3 py-2 rounded-lg bg-slate-900 border border-slate-800 outline-none" placeholder="Kinh độ" />
      <button id="go" class="px-3 py-2 rounded-lg bg-gradient-to-r from-indigo-500 to-cyan-500">Lấy dữ liệu</button>
    </div>

    <section class="grid grid-cols-1 lg:grid-cols-[2fr,1fr] gap-4">
      <div id="current" class="rounded-2xl p-6 text-center text-4xl font-extrabold bg-gradient-to-br from-slate-800 to-slate-900 border border-slate-800">Chưa có dữ liệu</div>
      <aside class="rounded-2xl p-4 bg-slate-900/70 border border-slate-800">
        <h3 class="mt-0 font-semibold">Chỉ số</h3>
        <div id="stats" class="text-slate-300">—</div>
      </aside>
    </section>

    <section class="rounded-2xl p-4 bg-slate-900/70 border border-slate-800 mt-4">
      <h3 class="mt-0 font-semibold">Dự báo 5 ngày</h3>
      <div id="forecast" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3"></div>
    </section>
  </main>

  <script>
    const q = (s)=> document.querySelector(s)
    const lat = q('#lat'), lon = q('#lon'), go = q('#go')
    const current = q('#current'), stats = q('#stats'), forecast = q('#forecast')

    async function fetchWeather(lat, lon){
      const url = new URL('https://api.open-meteo.com/v1/forecast')
      url.search = new URLSearchParams({
        latitude: lat, longitude: lon,
        current: 'temperature_2m,relative_humidity_2m,apparent_temperature,wind_speed_10m,weather_code',
        daily: 'temperature_2m_max,temperature_2m_min,precipitation_sum,weather_code',
        timezone: 'auto'
      })
      const res = await fetch(url)
      if(!res.ok) throw new Error('Fetch error')
      return await res.json()
    }
    function wcToIcon(w){ const m = {0:'☀️',1:'🌤️',2:'⛅',3:'☁️',45:'🌫️',48:'🌫️',51:'🌦️',61:'🌧️',71:'❄️',80:'🌧️',95:'⛈️'}; return m[w] || '🌡️' }

    function render(data){
      const c = data.current
      current.innerHTML = `${wcToIcon(c.weather_code)}<div class="text-5xl mt-2">${Math.round(c.temperature_2m)}°C</div>`
      stats.innerHTML = `Độ ẩm: ${c.relative_humidity_2m}%<br>Gió: ${c.wind_speed_10m} m/s<br>Thể cảm: ${Math.round(c.apparent_temperature)}°C`
      forecast.innerHTML = data.daily.time.slice(0,5).map((d,i)=>{
        const hi = Math.round(data.daily.temperature_2m_max[i]); const lo = Math.round(data.daily.temperature_2m_min[i]); const code = data.daily.weather_code[i]
        return `<div class="rounded-xl border border-slate-800 p-3 text-center">${wcToIcon(code)}<div class="text-sm">${d}</div><div class="font-semibold">${hi}°/${lo}°</div></div>`
      }).join('')
    }

    go.addEventListener('click', async ()=>{
      try{
        current.textContent = 'Đang tải...'
        const data = await fetchWeather(lat.value, lon.value)
        render(data)
      }catch(e){ current.textContent = 'Lỗi lấy dữ liệu' }
    })
  </script>
</body>
</html>
