<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Weather Geolocation â€” Level 2 (JS)</title>
  <style>
    :root{--bg:#0f1220;--card:#161a2b;--txt:#e5e7eb;--muted:#94a3b8}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:radial-gradient(1200px 600px at 10% 10%,#1e1b4b,#0b1020);color:var(--txt);min-height:100dvh}
    header{padding:24px;text-align:center}
    .wrap{width:min(1100px,92vw);margin:0 auto;padding-bottom:40px}
    .hero{background:linear-gradient(135deg,#1b1838,#0f1220);border-radius:16px;padding:24px;text-align:center;font-weight:800;font-size:42px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .grid{display:grid;grid-template-columns:2fr 1fr;gap:16px;margin-top:16px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border-radius:16px;padding:16px}
    .row{display:grid;grid-template-columns:repeat(5,1fr);gap:12px}
    .mini{height:120px;display:grid;place-items:center;border:1px solid #283055;border-radius:12px}
    .status{margin-top:8px;color:#94a3b8}
  </style>
</head>
<body>
  <header>
    <h1>ğŸ“ Weather App â€” Geolocation + Open-Meteo</h1>
    <p class="muted">Báº­t quyá»n truy cáº­p vá»‹ trÃ­ Ä‘á»ƒ xem thá»i tiáº¿t quanh báº¡n</p>
  </header>
  <main class="wrap">
    <section class="hero" id="hero">Äang chá» vá»‹ trÃ­â€¦</section>
    <div class="status" id="status"></div>
    <section class="grid">
      <aside class="card">
        <h3>Chá»‰ sá»‘</h3>
        <div id="stats">â€”</div>
      </aside>
      <div class="card">
        <h3>Dá»± bÃ¡o 5 ngÃ y</h3>
        <div id="forecast" class="row"></div>
      </div>
    </section>
  </main>

  <script>
    const hero = document.getElementById('hero')
    const statusEl = document.getElementById('status')
    const stats = document.getElementById('stats')
    const forecast = document.getElementById('forecast')

    function wcToIcon(w){
      const m = {0:'â˜€ï¸',1:'ğŸŒ¤ï¸',2:'â›…',3:'â˜ï¸',45:'ğŸŒ«ï¸',48:'ğŸŒ«ï¸',51:'ğŸŒ¦ï¸',61:'ğŸŒ§ï¸',71:'â„ï¸',80:'ğŸŒ§ï¸',95:'â›ˆï¸'}
      return m[w] || 'ğŸŒ¡ï¸'
    }

    async function fetchWeather(lat, lon){
      const url = new URL('https://api.open-meteo.com/v1/forecast')
      url.search = new URLSearchParams({
        latitude: lat, longitude: lon, timezone: 'auto',
        current: 'temperature_2m,relative_humidity_2m,apparent_temperature,wind_speed_10m,weather_code',
        daily: 'temperature_2m_max,temperature_2m_min,weather_code'
      })
      const res = await fetch(url); if(!res.ok) throw new Error('Weather failed')
      return await res.json()
    }

    function render(data){
      const c = data.current
      hero.innerHTML = `${wcToIcon(c.weather_code)}<br>${Math.round(c.temperature_2m)}Â°C`
      stats.innerHTML = `Äá»™ áº©m: ${c.relative_humidity_2m}%<br>GiÃ³: ${c.wind_speed_10m} m/s<br>Thá»ƒ cáº£m: ${Math.round(c.apparent_temperature)}Â°C`
      forecast.innerHTML = data.daily.time.slice(0,5).map((d,i)=>{
        const hi = Math.round(data.daily.temperature_2m_max[i])
        const lo = Math.round(data.daily.temperature_2m_min[i])
        const code = data.daily.weather_code[i]
        return `<div class="mini">${wcToIcon(code)}<br>${d}<br>${hi}Â°/${lo}Â°</div>`
      }).join('')
    }

    function getLocation(){
      if(!navigator.geolocation){
        statusEl.textContent = 'TrÃ¬nh duyá»‡t khÃ´ng há»— trá»£ geolocation.'
        return
      }
      statusEl.textContent = 'Äang yÃªu cáº§u quyá»n truy cáº­p vá»‹ trÃ­â€¦'
      navigator.geolocation.getCurrentPosition(async (pos)=>{
        statusEl.textContent = `VÄ© Ä‘á»™: ${pos.coords.latitude.toFixed(4)}, Kinh Ä‘á»™: ${pos.coords.longitude.toFixed(4)}`
        hero.textContent = 'Äang táº£i thá»i tiáº¿tâ€¦'
        try{
          const data = await fetchWeather(pos.coords.latitude, pos.coords.longitude)
          render(data)
        }catch(e){
          hero.textContent = 'Lá»—i láº¥y dá»¯ liá»‡u thá»i tiáº¿t.'
        }
      }, (err)=>{
        statusEl.textContent = 'KhÃ´ng láº¥y Ä‘Æ°á»£c vá»‹ trÃ­: ' + err.message
        hero.textContent = 'Cáº§n quyá»n vá»‹ trÃ­ Ä‘á»ƒ hiá»ƒn thá»‹.'
      }, { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 })
    }

    getLocation()
  </script>
</body>
</html>
